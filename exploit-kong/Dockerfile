FROM alpine:3.7

RUN apk --no-cache add curl

COPY ./deploy.sh /usr/mock/deploy.sh
COPY ./wait_run_curl_status.sh /usr/mock/wait_run_curl_status.sh
COPY ./mount/apis /mnt/kong_files/apis
COPY ./mount/plugins /mnt/kong_files/plugins

VOLUME ["/mnt/kong_files/apis", "/mnt/kong_files/plugins"]
ENV CHECK_URL_SERVICE_UP="http://kong:8001"
ENV CHECK_STATUS_SERVICE_UP=200
ENV CHECK_RETRY_SERVICE_UP=30
ENTRYPOINT [ "/usr/mock/wait_run_curl_status.sh","/usr/mock/deploy.sh" ]
CMD ["-d","-Hkong"]